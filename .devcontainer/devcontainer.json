// For format details, see https://aka.ms/devcontainer.json. For config options, see the
// README at: https://github.com/devcontainers/templates/tree/main/src/dotnet
{
	"name": "C# (.NET) with Cloudflare Tunnel", // Give it a more descriptive name
	"dockerComposeFile": [
		"docker-compose.yml",       // Path to project's base compose file
		"docker-compose.dev.yml"    // Path to dev environment compose file
	],
	"service": "dev-container",  // The service in docker-compose.dev.yml that defines dev container
	"workspaceFolder": "/workspaces/Training_Bank", // Specify the workspace folder in the container

	// Keep features defined here, or move some to docker-compose.dev.yml if they are specific to the dev container
	"features": {
		"ghcr.io/devcontainers/features/docker-outside-of-docker:1": {},
		"ghcr.io/devcontainers/features/azure-cli:1": {},
    	"ghcr.io/devcontainers/features/github-cli:1": {},
		"ghcr.io/devcontainers/features/kubectl-helm-minikube:1":{}
	},

	"remoteUser": "vscode", // Keep your remoteUser

	// The postCreateCommand needs to be adapted slightly.
	// Commands can be run directly within the dev container after it's started by docker-compose.
	// Ensure the necessary tools are available in the dev container image.
	// "postCreateCommand": "sudo apt-get update && sudo apt-get install -y ca-certificates curl apt-transport-https lsb-release gnupg && sudo mkdir -p /etc/apt/keyrings && curl -sLS https://packages.microsoft.com/keys/microsoft.asc | sudo gpg --dearmor -o /etc/apt/keyrings/microsoft.gpg && sudo chmod go+r /etc/apt/keyrings/microsoft.gpg && echo \"deb [arch=$(dpkg --print-architecture) signed-by=/etc/apt/keyrings/microsoft.gpg] https://packages.microsoft.com/repos/azure-cli/ $(lsb_release -cs) main\" | sudo tee /etc/apt/sources.list.d/azure-cli.list && sudo apt-get update && sudo apt-get install -y azure-cli && curl -LO \"https://dl.k8s.io/release/$(curl -L -s https://dl.k8s.io/release/stable.txt)/bin/linux/amd64/kubectl\" && sudo install -o root -g root -m 0755 kubectl /usr/local/bin/kubectl && rm kubectl && curl -fsSL https://cli.github.com/packages/githubcli-archive-keyring.gpg | sudo dd of=/usr/share/keyrings/githubcli-archive-keyring.gpg && sudo chmod go+r /usr/share/keyrings/githubcli-archive-keyring.gpg && echo \"deb [arch=$(dpkg --print-architecture) signed-by=/usr/share/keyrings/githubcli-archive-keyring.gpg] https://cli.github.com/packages stable main\" | sudo tee /etc/apt/sources.list.d/github-cli.list > /dev/null && sudo apt-get update && sudo apt-get install -y gh && git config --global --add safe.directory /workspaces/Training_Bank && git config --global --add safe.directory /workspaces/Training_Bank/Training_Bank.wiki && dotnet restore /workspaces/Training_Bank/backend/Training_Bank_Backend.sln",
	"postCreateCommand": "git config --global --add safe.directory /workspaces/Training_Bank && git config --global --add safe.directory /workspaces/Training_Bank/Training_Bank.wiki && dotnet restore /workspaces/Training_Bank/backend/Training_Bank_Backend.sln && sudo mkdir -p --mode=0755 /usr/share/keyrings && curl -fsSL https://pkg.cloudflare.com/cloudflare-main.gpg | sudo tee /usr/share/keyrings/cloudflare-main.gpg >/dev/null && echo \"deb [signed-by=/usr/share/keyrings/cloudflare-main.gpg] https://pkg.cloudflare.com/cloudflared $(lsb_release -cs) main\" | sudo tee /etc/apt/sources.list.d/cloudflared.list && sudo apt-get update && sudo apt-get install -y cloudflared",

	"customizations": {
		"vscode": {
			"settings": {
				"dev.containers.mountWaylandSocket": false
			}
		}
	}
}
